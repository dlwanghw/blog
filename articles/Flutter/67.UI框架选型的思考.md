
## UI框架发展的趋势

**1.从命令式UI往声明式UI发展**

比如iOS中的UIKit到SwiftUI, Android中的View到Jetpack Compose。

这样可以实现更加直观便捷的UI开发。

**2.UI框架和语言运行时深度融合**

SwiftUI，Jetpack Compose， Flutter都利用了各自的语言特性 - 比如在UI描述方面，SwiftUI中的Swift语言,Jetpack Compose中的Kotlin语言都精简了UI描述语法；在性能方面， Swift通过引入轻量化结构体等语言特性更好的实现内存快速分配和释放，Flutter中Dart语言则在运行时专门针对小对象内存管理做相应优化，在GC方面，Swift、以及Dart、JS无一例外都选择了带GC功能，减少开发人员的开发负担。

**3.跨平台（OS）能力**

跨平台（OS）能力可以让一套代码复用到不同的OS上，主要是为了提升开发效率，降低开发成本。不过这里面也有一系列的挑战，比如运行在不同平台上的性能问题，能力和渲染效果的一致性问题等

## 团队的内需

1. 目标:维持单一语言的技术栈
   这样可以实现团队内的技术共享(有知识库参考--人/参考示例)
   可以积累通用的软件库，即可复用的软件库集合
   人员可复用，风险抵御能力增加
2. 原则：选择语言的依据
   1. 语言自身的特性
      1. 语言特性(功能实现的容易度)
      2. 多核CPU的运用能力
      3. 发展潜力、是否是高速演进的状态(是否是热点语言，有一个蓬勃发展的生态)
      4. 开发友好性：编码智能提示、调试工具、集成测试驱动框架、性能调优工具、
      5. 运维友好性：便于和现有的监控系统集成，如类似JAVA提供的无侵入的日志监控方案
   2. 语言的生态友好性
      1. 有可以复用的开发组件(虽然微服务不强制要求语言，但是统一语言的开源组件有巨大的维护优势)
      2. 有庞大的知识库(比如现成的参考例子，csdn等网站上发布的帖子)
      3. 和架构组件的兼容性，架构组件是否提供了该语言的接口
   3. 团队的熟悉度
      1. 开发人员是否会用、学习迁移成本有多高
      2. 团队内是否沉淀了有效的知识库(培训、指南、编程建议、代码片段、IDE插件开发等)
      3. 团队内是否已经沉淀了可复用的组件
   4. 是否能够很好的利旧
      1. 如何最大化复用Legency资产
3. 教训：过去架构中的教训
   1. 逻辑内聚的单元需要使用单一语言实现，如果两个模块结合非常紧密--接口非常多，使用不同的语言，则在语言上的的转换、内存的管理等方面需要耗费的精力就会很多，比如上个参与项目中使用java来封装c++组件接口，因为组件的接口太多了，跨语言使用不方便扩展
   2. 基础组件需要基于开源来做，否则开发投入、持续维护的投入都会非常多，当然前提是开源基础组件选择的准确，因为不能确保是否能选择的准确，所以要做好隔离。
   3. UI框架是很难和业务应用隔离的，但是可以将隔离限制在UI，这样做的前提是要适配多个系统，将系统间共通的独立出来、得到的成本是比接口隔离带来的成本增加值是大的。

## 备选方案

1. 自主实现、维护后端渲染，将现在项目所依赖的Chrome换芯，=>其本质考虑是将来使用Web前端的开发方式来开发App
2. 使用flutter，为了更好的利旧，参考北海完成适配，也能实现换芯。当然换芯的效果需要确认，=>其本质上是将来使用flutter来开发App，引入北海仅仅是为了利旧。 

3. 纯技术角度考虑选择Flutter/Dart的优势
   1. **语言特性更现代**，相比JS来说，有严格的类型校验，引入Nullsafty，是一个快速发展的语言  > js
   2. 多核CPU的运用能力  无视
   3. 发展潜力高、google-trend上flutter已经超过了react native，在最新的开源指数排名中排名12位 <>js
   4. 开发友好性： 智能编码提示>js，如果和quickjs相比远远领先，quickjs没有调试器及热重载，更不用说性能优化之类的工具，和v8相比，略弱。
   5. 运维友好性: 
   6. 可以复用的开发组件  <js  dart在快速扩充中
   7. 有庞大的知识库     <> js 绝对数量上js会更多，但从满足开发需求角度，dart也足够  
   8. 和架构组件的兼容性    无视
   9. 开发人员的迁移成本  >js
   10. 团队沉淀  无视
   11. **是否能够很好的利旧** <js
   12. **框架性能**  >js  取决于js所用的运行时，和v8相差不大，要是其他js运行时则会领先很多，语言方面：dartvm采用aot，而v8采用jit互有优势，其他非jit的js运行时就没有优势了。框架方面，flutter使用widget语言声明式ui编程也要比js解析生成dom树要快。
   13. **框架对平台的兼容性** >js 取决于js所用的框架，和v8相比，v8兼容各大平台，但是能做到像flutter小巧且移植性高的还有差距


> 技术面总结：
> 1. 在语言特性、框架性能、平台的兼容性和扩展性上，比JS有优势.  扩展性主要是考虑和其他语言的互操作方面是比js要方便的多,如dartffi机制就可以实现无侵入的扩展flutter框架能力，可以很方便的接入既有系统的C++的资产;平台兼容性方面flutter能够和既有的平台都很好的兼容，可以由1-2个人就能实现flutter和新平台的渲染机制适配工作，如和GTK适配; dartvm采用aot编译也比非v8的js运行时要快。
> 2. 在既有的生态、既有的资产最大化复用方面，辩证的看，在生态上也仅仅是不如JS,也仅仅是和JS比较，网上的文章已经很多了，开源的也比较多了，毕竟在开源指数排名中排名12,仅次于Vue和React。如果参考北海，能够很好的利旧，那么选择flutter是否很好的方案。
> 3. 潜在要解决的问题：北海的架构能够在性能上和原来的v8持平么？需要POC实测。


4. 其他的考虑要素：
   1. 商业上的？？
   2. 自主可控的要求，开源的只是无法掌控方向，技术可控是可以做到的
   3. 自主IP的要求，客户是否认为自主IP、闭源有价值？？



---
参考网上的一片文章，记录下flutter和electron之间的数据对比：
https://juejin.cn/post/7018450473292136456

应用启动时间  f(1s) e(1s)
helloworld可执行文件 f(22.7mb) e(183mb)
内存占用率    f(38mb) e(100mb)
每秒帧数      f(每帧3ms) e(每帧16-17ms)

---
附录
**声明式框架和命令式框架的定义**

从编程方式上来看，UI框架一般可分为命令式UI框架和声明式UI框架两种:

1.命令式UI框架。过程导向 - 告诉“机器”具体步骤，命令“机器”按照指定步骤去做。比如Android原生UI框架（View框架）或iOS的UIKit，提供了一系列的API让开发者直接操控UI组件-比如定位到某个指定UI组件，进行属性变更等。这种方式的优点是开发者可以控制具体的实现路径，经验丰富的开发者能够写出较为高效的实现。不过这种情况下，开发者需了解大量的API细节并指定好具体的执行路径，开发门槛较高。具体的实现效果上，也高度依赖开发者本身的开发技能。另外，由于和具体实现绑定较紧，在跨设备情况下，灵活性和扩展性相对有限。

2.声明式UI框架。结果导向 - 告诉“机器”你需要什么，机器负责怎么去做。比如Web前端框架Vue,或iOS的SwiftUI等，框架会根据声明式语法的描述，渲染出相应的UI，同时结合相应编程模型，框架会根据数据的变化来自动更新相应的UI。

这种方式的优点是开发者只需描述好结果，相应的实现和优化由框架来处理。另外，由于结果描述和具体实现分离，实现方式相对灵活同时容易扩展。不过这种情况下，对框架的要求较高，需要框架有完备的直观的描述能力并能够针对相应的描述信息实现高效的处理。




